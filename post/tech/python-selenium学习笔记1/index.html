<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="referrer" content="never">
﻿		<meta data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal">
		<meta name="google-site-verification" content="dPRIGT6c9t7qlyu4J5tqBvaNa5kOCUrxT7H4m6x6LK8" />
        <title>Python Selenium学习笔记</title>
        
        <style>

    html body {
        font-family: '', sans-serif;
        background-color: white;
    }

    :root {
        --accent: purple;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://hui1hui2hui3.github.io/blog/css/main.css">








 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script>






<script src="https://code.jquery.com/jquery-3.4.1.js"></script>


<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.62.2" />
        

        

        
            <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
		
            <script src="//cdn.jsdelivr.net/npm/@waline/client"></script>
        

        

    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand visible-xs" href="#">Python Selenium学习笔记</a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/blog/">Home</a></li>
                            
                                <li><a href="/blog/post/">Posts</a></li>
                            
                                <li><a href="/blog/tags/">Tags</a></li>
                            
                                <li><a href="/blog/about/">About</a></li>
                            
                        </ul>
                    
                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/hui1hui2hui3/"><i class="fab fa-github"></i></a></li>
                            
                        </ul>
                    
                </div>
            </div>
        </nav>


<main>

    <div>
        <h2>Python Selenium学习笔记</h2>
        <h5>September 26, 2016</h5>
        
<a href="https://hui1hui2hui3.github.io/blog/tags/python"><kbd class="item-tag">Python</kbd></a>

<a href="https://hui1hui2hui3.github.io/blog/tags/selenium"><kbd class="item-tag">Selenium</kbd></a>

<a href="https://hui1hui2hui3.github.io/blog/tags/unittest"><kbd class="item-tag">UnitTest</kbd></a>


    </div>

    <div align="start" class="content"><h2 id="如何运行单元测试时只运行一个浏览器而不是每个testcase都打开一个浏览器">如何运行单元测试时只运行一个浏览器，而不是每个TestCase都打开一个浏览器</h2>
<p>具体实现方法：</p>
<pre><code>class BaseUnitTest(unittest.TestCase):
    # --实例属性区--
    &quot;&quot;&quot;是否开启TestCase级别的单驱动模式,默认False
    开启时, 一个TestCase只会打开一个浏览器,也就是method之间是公用浏览器,
    而不是每个测试Method都打开一个浏览器
    &quot;&quot;&quot;
    SINGLE_DRIVER = False

    # --类方法区--
    @classmethod
    def setUpClass(cls):
        cls.driver = None

    @classmethod
    def tearDownClass(cls):
        if cls.SINGLE_DRIVER:
            BaseUnitTest.__quit_driver(cls.driver)
    
    # --静态方法区--
    @staticmethod
    def __new_driver():
        driver = browser(env.BROWSER, env.DRIVER_PATH)
        driver.maximize_window()
        return driver

    @staticmethod
    def __quit_driver(driver):
        if env.BROWSER.upper() == 'PHANTOMJS':
            # 这里是为了能够真正的退出
            driver.service.process.send_signal(signal.SIGTERM)
        driver.quit()
        
     def setUp(self):
        if self.SINGLE_DRIVER:
            if self.__class__.driver is None:
                self.driver = BaseUnitTest.__new_driver()
                self.__class__.SINGLE_DRIVER = self.SINGLE_DRIVER
                self.__class__.driver = self.driver
            else:
                self.driver = self.__class__.driver
        else:
            self.driver = BaseUnitTest.__new_driver()

    def tearDown(self):
        if not self.SINGLE_DRIVER:
            BaseUnitTest.__quit_driver(self.driver)
</code></pre><h2 id="如何用多线程运行selenium测试">如何用多线程运行Selenium测试</h2>
<blockquote>
<ul>
<li><code>threading.Thread</code>线程方式,这种方式需要注意的是多个线程之间的相互影响，导致共享值的变化，下面是实现方式（这种有问题，就是不知道合适的时机和方式去关闭driver）：</li>
</ul>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># coding=utf-8</span>

<span style="color:#f92672">import</span> unittest
<span style="color:#f92672">import</span> threading
<span style="color:#f92672">from</span> driver <span style="color:#f92672">import</span> browser
<span style="color:#f92672">import</span> env
<span style="color:#f92672">import</span> signal
<span style="color:#f92672">import</span> utils
<span style="color:#f92672">import</span> dataUtils
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">from</span> time <span style="color:#f92672">import</span> ctime


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseUnitTest</span>(unittest<span style="color:#f92672">.</span>TestCase):
    <span style="color:#75715e"># --实例属性区--</span>
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74">是否开启TestCase级别的单驱动模式,默认False</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">    开启时, 一个TestCase只会打开一个浏览器,也就是method之间是公用浏览器,</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">    而不是每个测试Method都打开一个浏览器</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">    </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
    SINGLE_DRIVER <span style="color:#f92672">=</span> False

    <span style="color:#75715e"># --类方法区--</span>
    <span style="color:#a6e22e">@classmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setUpClass</span>(cls):
        env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>SINGLE_DRIVER <span style="color:#f92672">=</span> cls<span style="color:#f92672">.</span>SINGLE_DRIVER

    <span style="color:#a6e22e">@classmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tearDownClass</span>(cls, is_thread<span style="color:#f92672">=</span>False):
        <span style="color:#66d9ef">if</span> is_thread <span style="color:#f92672">and</span> env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>SINGLE_DRIVER:
            BaseUnitTest<span style="color:#f92672">.</span>__quit_driver(env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>driver)

    <span style="color:#75715e"># --静态方法区--</span>
    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__new_driver</span>():
        driver <span style="color:#f92672">=</span> browser(env<span style="color:#f92672">.</span>BROWSER, env<span style="color:#f92672">.</span>DRIVER_PATH)
        driver<span style="color:#f92672">.</span>maximize_window()
        <span style="color:#66d9ef">return</span> driver

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__quit_driver</span>(driver):
        <span style="color:#66d9ef">if</span> env<span style="color:#f92672">.</span>BROWSER<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">PHANTOMJS</span><span style="color:#e6db74">&#39;</span>:
            <span style="color:#75715e"># 这里是为了能够真正的退出</span>
            driver<span style="color:#f92672">.</span>service<span style="color:#f92672">.</span>process<span style="color:#f92672">.</span>send_signal(signal<span style="color:#f92672">.</span>SIGTERM)
        driver<span style="color:#f92672">.</span>quit()

    <span style="color:#75715e"># --实例方法区--</span>
    <span style="color:#75715e"># 1.重写父类区</span>
    <span style="color:#66d9ef">def</span> __init__(self, methodName<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">runTest</span><span style="color:#e6db74">&#39;</span>):
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#e6db74"> overide the TestCase __init__ Method</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">            so need to recall the TestCase __init__ method</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">        </span><span style="color:#e6db74">&#39;&#39;&#39;</span>
        super(BaseUnitTest, self)<span style="color:#f92672">.</span>__init__(methodName)
        self<span style="color:#f92672">.</span>__testMethodName <span style="color:#f92672">=</span> methodName

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setUp</span>(self):
        <span style="color:#66d9ef">if</span> env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>SINGLE_DRIVER:
            <span style="color:#66d9ef">if</span> env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>driver <span style="color:#f92672">is</span> None:
                env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>driver <span style="color:#f92672">=</span> BaseUnitTest<span style="color:#f92672">.</span>__new_driver()
            self<span style="color:#f92672">.</span>driver <span style="color:#f92672">=</span> env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>driver
        <span style="color:#66d9ef">else</span>:
            self<span style="color:#f92672">.</span>driver <span style="color:#f92672">=</span> BaseUnitTest<span style="color:#f92672">.</span>__new_driver()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tearDown</span>(self):
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> env<span style="color:#f92672">.</span>thread_local<span style="color:#f92672">.</span>SINGLE_DRIVER:
            BaseUnitTest<span style="color:#f92672">.</span>__quit_driver(self<span style="color:#f92672">.</span>driver)

    <span style="color:#75715e"># 2.自定义方法区</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">assertEqualUnicode</span>(self, a, b):
        a <span style="color:#f92672">=</span> dataUtils<span style="color:#f92672">.</span>decodeToUnicode(a)
        b <span style="color:#f92672">=</span> dataUtils<span style="color:#f92672">.</span>decodeToUnicode(b)
        self<span style="color:#f92672">.</span>assertEqual(a, b)

    <span style="color:#75715e"># 3.私有方法区</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__exc_info</span>(self):
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#e6db74"> copy from TestCase ,aim to overide the TestCase __call__ method</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">        </span><span style="color:#e6db74">&#39;&#39;&#39;</span>
        exctype, excvalue, tb <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>exc_info()
        <span style="color:#66d9ef">if</span> sys<span style="color:#f92672">.</span>platform[:<span style="color:#ae81ff">4</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">java</span><span style="color:#e6db74">&#39;</span>:  <span style="color:#75715e"># tracebacks look different in Jython</span>
            <span style="color:#66d9ef">return</span> (exctype, excvalue, tb)
        newtb <span style="color:#f92672">=</span> tb<span style="color:#f92672">.</span>tb_next
        <span style="color:#66d9ef">if</span> newtb <span style="color:#f92672">is</span> None:
            <span style="color:#66d9ef">return</span> (exctype, excvalue, tb)
        <span style="color:#66d9ef">return</span> (exctype, excvalue, newtb)

    <span style="color:#66d9ef">def</span> __call__(self, result<span style="color:#f92672">=</span>None):
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#e6db74"> overide the TestCase __call__ method</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">            aim to add insert_img_decorator to the test_case method</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">        </span><span style="color:#e6db74">&#39;&#39;&#39;</span>
        <span style="color:#66d9ef">if</span> result <span style="color:#f92672">is</span> None:
            result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>defaultTestResult()
        result<span style="color:#f92672">.</span>startTest(self)
        testMethod <span style="color:#f92672">=</span> getattr(self, self<span style="color:#f92672">.</span>__testMethodName)
        newMethod <span style="color:#f92672">=</span> utils<span style="color:#f92672">.</span>insert_img_decorator(
            self<span style="color:#f92672">.</span>__testMethodName)(testMethod)
        <span style="color:#66d9ef">try</span>:
            <span style="color:#66d9ef">try</span>:
                self<span style="color:#f92672">.</span>setUp()
            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyboardInterrupt</span>:
                <span style="color:#66d9ef">raise</span>
            <span style="color:#66d9ef">except</span>:
                result<span style="color:#f92672">.</span>addError(self, self<span style="color:#f92672">.</span>__exc_info())
                <span style="color:#66d9ef">return</span>

            ok <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">try</span>:
                newMethod(self)
                ok <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
            <span style="color:#66d9ef">except</span> self<span style="color:#f92672">.</span>failureException, e:
                result<span style="color:#f92672">.</span>addFailure(self, self<span style="color:#f92672">.</span>__exc_info())
            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyboardInterrupt</span>:
                <span style="color:#66d9ef">raise</span>
            <span style="color:#66d9ef">except</span>:
                result<span style="color:#f92672">.</span>addError(self, self<span style="color:#f92672">.</span>__exc_info())

            <span style="color:#66d9ef">try</span>:
                self<span style="color:#f92672">.</span>tearDown()
            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyboardInterrupt</span>:
                <span style="color:#66d9ef">raise</span>
            <span style="color:#66d9ef">except</span>:
                result<span style="color:#f92672">.</span>addError(self, self<span style="color:#f92672">.</span>__exc_info())
                ok <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">if</span> ok:
                result<span style="color:#f92672">.</span>addSuccess(self)
        <span style="color:#66d9ef">finally</span>:
            result<span style="color:#f92672">.</span>stopTest(self)
</code></pre></div><blockquote>
<ul>
<li><code>multiprocessing</code>进程方式，这种方式可以避免线程上的值共享被共同访问时的问题，但是需要注意其他问题，就是测试结果如何共享的问题，实现代码如上</li>
</ul>
</blockquote>
<h2 id="unittest执行过程分析-testloader">unittest执行过程分析-TestLoader</h2>
<p><strong>TestLoader.discover</strong>发现的结果如下：</p>
<pre><code>&lt;unittest.suite.TestSuite
    tests=[
        &lt;unittest.suite.TestSuite
            tests=[
                &lt;unittest.suite.TestSuite tests=[]&gt;,
                &lt;unittest.suite.TestSuite
                    tests=[
                        &lt;exam_manager_test.ExamManageTest testMethod=test_a_add_exam&gt;,
                        &lt;exam_manager_test.ExamManageTest testMethod=test_b_search_exam&gt;
                        ]
                &gt;
            ]
        &gt;,
        &lt;unittest.suite.TestSuite
            tests=[
                &lt;unittest.suite.TestSuite tests=[]&gt;,
                &lt;unittest.suite.TestSuite
                    tests=[
                        &lt;exam_manager_1_test.ExamManageTest testMethod=test_c_add_exam&gt;,
                        &lt;exam_manager_1_test.ExamManageTest testMethod=test_d_search_exam&gt;
                        ]
                &gt;
            ]
        &gt;
    ]
&gt;
</code></pre><p>数据知道了，那具体流程图如下：</p>
<pre><code class="language-flow" data-lang="flow">st=&gt;start: Start
suite=&gt;operation: TestSuite Run
teardownclass=&gt;operation: TestCase TearDownPreClass
setupmodule=&gt;operation: TestCase SetUpModule
setupclass=&gt;operation: TestCase SetUpClass
for=&gt;operation: Iterator TestSuite
cond=&gt;condition: Is TestSuite?
case=&gt;operation: TestCase Run
setup=&gt;operation: TestCase SetUp
teardown=&gt;operation: TestCase TearDown
islastcase=&gt;condition: Is Last TestCase?
teardownmodule=&gt;operation: TestCase TearDownModule
teardownclass2=&gt;operation: TestCase TearDownClass
end=&gt;end: End

st-&gt;suite-&gt;for-&gt;cond
cond(yes,right)-&gt;suite(right)
cond(no)-&gt;teardownclass-&gt;setupmodule-&gt;setupclass
setupclass-&gt;setup-&gt;case-&gt;teardown-&gt;islastcase
islastcase(no,right)-&gt;for(left)
islastcase(yes)-&gt;teardownclass2-&gt;teardownmodule-&gt;end
</code></pre></div>

    
    
    
        <h4 class="page-header">Related</h4>
         <div class="item">

    
    
    

    
    

    <h4><a href="/blog/post/life/%E7%94%B5%E6%A2%AF%E9%9A%BE%E9%A2%98/">在扶手电梯上是走还是站？</a></h4>
    <h5>December 6, 2021</h5>
    
<a href="https://hui1hui2hui3.github.io/blog/tags/%E7%94%9F%E6%B4%BB"><kbd class="item-tag">生活</kbd></a>

<a href="https://hui1hui2hui3.github.io/blog/tags/%E7%94%B5%E6%A2%AF"><kbd class="item-tag">电梯</kbd></a>

<a href="https://hui1hui2hui3.github.io/blog/tags/python"><kbd class="item-tag">Python</kbd></a>



</div>
  <div class="item">

    
    
    

    
    

    <h4><a href="/blog/post/tech/python%E5%A4%9A%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86/">Python多环境管理</a></h4>
    <h5>October 16, 2019</h5>
    
<a href="https://hui1hui2hui3.github.io/blog/tags/python"><kbd class="item-tag">Python</kbd></a>



</div>
  <div class="item">

    
    
    

    
    

    <h4><a href="/blog/post/tech/python-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%92%8C%E7%BB%9F%E8%AE%A1/">如何查看git提交近期的所有的改动或新增的文件-Python实现</a></h4>
    <h5>September 22, 2016</h5>
    
<a href="https://hui1hui2hui3.github.io/blog/tags/git"><kbd class="item-tag">Git</kbd></a>

<a href="https://hui1hui2hui3.github.io/blog/tags/python"><kbd class="item-tag">Python</kbd></a>



</div>
 
    

    
    
	
	
		<div id="waline"></div>
		<script>
			Waline({
			  el: '#waline',
			  serverURL: 'https://myblog-waline-5cpzcds7x-hui1hui2hui3-gmailcom.vercel.app',
			});
		 </script>
	
	

</main>

        <footer>
            <p class="copyright text-muted">© All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>.</p>
        </footer>

        

        
    </body>

</html>

