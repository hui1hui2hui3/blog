<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="referrer" content="never">
﻿		<meta data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal">
		<meta name="google-site-verification" content="dPRIGT6c9t7qlyu4J5tqBvaNa5kOCUrxT7H4m6x6LK8" />
        <title>Windows 睡眠等待机制 timeout,waitfor,ping</title>
        
        <style>

    html body {
        font-family: '', sans-serif;
        background-color: white;
    }

    :root {
        --accent: purple;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="/blog/css/main.css">








 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous" />
 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js"></script>
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script>






<script src="https://code.jquery.com/jquery-3.4.1.js"></script>


<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<script>$(document).on('click', function() { $('.collapse').collapse('hide'); })</script>
 <meta name="generator" content="Hugo 0.62.2" />
        

        

        
            <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
		
            <script src="//cdn.jsdelivr.net/npm/@waline/client"></script>
        

        

    </head>

    <body>
        

        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand visible-xs" href="#">Windows 睡眠等待机制 timeout,waitfor,ping</a>
                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse">
                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="/blog/">Home</a></li>
                            
                                <li><a href="/blog/post/">Posts</a></li>
                            
                                <li><a href="/blog/tags/">Tags</a></li>
                            
                                <li><a href="/blog/about/">About</a></li>
                            
                        </ul>
                    
                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/hui1hui2hui3/"><i class="fab fa-github"></i></a></li>
                            
                        </ul>
                    
                </div>
            </div>
        </nav>


<main>

    <div>
        <h2>Windows 睡眠等待机制 timeout,waitfor,ping</h2>
        <h5>October 30, 2017</h5>
        
<a href="/blog/tags/windows"><kbd class="item-tag">Windows</kbd></a>

<a href="/blog/tags/batch"><kbd class="item-tag">Batch</kbd></a>


    </div>

    <div align="start" class="content"><p>[TOC]</p>
<pre><code>尝试实现window batch脚本中等待机制，即不在命令行输出等待倒计时，直接等待到时间结束
</code></pre>
<h2 id="timeout">Timeout</h2>
<h3 id="语法">语法：</h3>
<p><code>TIMEOUT [/T] timeout [/NOBREAK]</code></p>
<h3 id="描述">描述:</h3>
<pre><code>这个工具接受超时参数，等候一段指定的时间(秒)或等按任意键。它还接受
一个参数，忽视按键。
</code></pre>
<h3 id="参数列表">参数列表:</h3>
<pre><code>/T        timeout       指定等候的秒数。有效范围从 -1 到 99999 秒。

/NOBREAK                忽略按键并等待指定的时间。

/?                      显示此帮助消息。
</code></pre>
<p><strong>注意: 超时值 -1 表示无限期地等待按键。</strong></p>
<h3 id="普通示例">普通示例:</h3>
<pre><code>TIMEOUT /?
TIMEOUT /T 10
TIMEOUT /T 300 /NOBREAK
TIMEOUT /T -1
</code></pre>
<h3 id="高级实例">高级实例：</h3>
<pre><code>timeout /t 10 /nobreak &gt; NUL
</code></pre><p><strong>实际等待时间：10s</strong></p>
<h3 id="jenkins运行结果">Jenkins运行结果：</h3>
<p><strong>错误: 不支持输入重新定向，立即退出此进程。</strong></p>
<h2 id="waitfor">Waitfor</h2>
<p>WaitFor 有两种运行方式:</p>
<h3 id="语法-1-发送信号">语法 1: 发送信号</h3>
<pre><code>WAITFOR [/S system [/U user [/P [password]]]] /SI signal
</code></pre>
<h3 id="语法-2-等候信号">语法 2: 等候信号</h3>
<pre><code>WAITFOR [/T timeout] signal
</code></pre>
<h3 id="描述-1">描述:</h3>
<pre><code>此工具在系统上发送或等待信号。当没有指定 /S 时，信号会被广播到一个
域的所有系统上。如果指定了/S，信号只发送到指定的系统上。
</code></pre>
<h3 id="参数列表-1">参数列表:</h3>
<pre><code>/S     system         指定远程系统以便发送信号。

/U     [domain\]user  指定用户上下文，命令在此上下文中执行。

/P     [password]     指定给定用户上下文的密码。

/SI                   把信号发送到网络上正在等待的机器。

/T     timeout        等待信号的秒数。有效范围是 1 - 99999。默认值
                      是永远等待信号。

signal                等待或发送的信号名称。

/?                    显示此帮助消息。

注意: 系统可以等待多个唯一的信号名称。信号名不能超过 225 个字符，
而且不能含有 a-z、A-Z、0-9 和范围为 128-255 的 ASCII 字符之外的
字符。
</code></pre>
<h3 id="普通示例-1">普通示例：</h3>
<pre><code>WAITFOR /?
WAITFOR SetupReady
WAITFOR CopyDone /T 100
WAITFOR /SI SetupReady
WAITFOR /S system  /U user /P password /SI CopyDone
</code></pre><p><strong>注意：waitfor 的事件如果等不到信号，则会出现“错误: 等候 &lsquo;SomethingThatIsNeverHappening&rsquo; 时超时”</strong></p>
<h3 id="高级示例">高级示例：</h3>
<pre><code>waitfor SomethingThatIsNeverHappening /t 10 2&gt;NUL
</code></pre><p><strong>实际等待时间：10s</strong></p>
<h3 id="jenkins运行结果-1">Jenkins运行结果：</h3>
<pre><code>Finished: FAILURE //可以正常等待，但是结果Failure
</code></pre><p>改进：</p>
<pre><code>waitfor SomethingThatIsNeverHappening /t 10 2&gt;NUL
...//其他代码
EXIT /b 0
</code></pre><h2 id="ping">Ping</h2>
<h3 id="高级示例-1">高级示例：</h3>
<pre><code>ping 127.0.0.1 -n 6 &gt; nul
</code></pre><p><strong>实际等待时间5秒，也就是n-1秒</strong></p>
<h3 id="jenkins运行结果-2">Jenkins运行结果：</h3>
<pre><code>OK
</code></pre><h3 id="ping-如何判断网络有问题">Ping 如何判断网络有问题</h3>
<pre><code>Ping 192.168.60.217 -n 4 -w 1000 | find &quot;TTL=&quot; &gt;nul
if errorlevel 1 (
    echo &quot;no connect&quot;
    exit -1
)
</code></pre></div>

    
    
    
        <h4 class="page-header">Related</h4>
         <div class="item">

    
    
    

    
    

    <h4><a href="/blog/post/tech/windows-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8E%A7%E5%88%B6-psexec/">Windows 远程命令行控制--PsExec</a></h4>
    <h5>July 19, 2017</h5>
    
<a href="/blog/tags/windows"><kbd class="item-tag">Windows</kbd></a>



</div>
  <div class="item">

    
    
    

    
    

    <h4><a href="/blog/post/tech/windows-%E6%89%B9%E5%A4%84%E7%90%86cmd_bat%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/">Windows 批处理Batch使用手册</a></h4>
    <h5>July 3, 2017</h5>
    
<a href="/blog/tags/batch"><kbd class="item-tag">Batch</kbd></a>



</div>
  <div class="item">

    
    
    

    
    

    <h4><a href="/blog/post/tech/windows-batch-%E7%BC%96%E7%A8%8B-forexist/">Windows Batch 编程--For，Exist</a></h4>
    <h5>July 3, 2017</h5>
    
<a href="/blog/tags/batch"><kbd class="item-tag">Batch</kbd></a>



</div>
 
    

    
    
	
	
		<div id="waline"></div>
		<script>
			Waline({
			  el: '#waline',
			  serverURL: 'https://myblog-waline-5cpzcds7x-hui1hui2hui3-gmailcom.vercel.app',
			});
		 </script>
	
	

</main>

        <footer>
            <p class="copyright text-muted">© All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a>.</p>
        </footer>

        

        
    </body>

</html>

